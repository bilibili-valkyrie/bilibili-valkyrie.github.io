import{v as e,R as t,S as a,B as n,i as r,a as l,C as c,u as o,b as s,c as i,d as m,e as u,f as d,I as p,g as E,h,m as g,M as w,j as y,A as v,T as k,k as f,l as b,n as C,o as S,p as $,q as T,r as I,s as R,t as x,w as B,x as D,y as U,z as O,D as j,E as z,F,G as M,H as V,J as A,K as N,L as W,N as L,O as H,P as _,Q as P,U as q,V as G,W as J,X as K,Y as Q}from"./vendor.b424f8be.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const c=new URL(e,n);if(self[t].moduleMap[c])return a(self[t].moduleMap[c]);const o=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){l(new Error(`Failed to import: ${e}`)),r(s)},onload(){a(self[t].moduleMap[c]),r(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/assets/");const X=({children:e})=>{const r=t.createRef(),l=e=>()=>{r.current.closeSnackbar(e)};return t.createElement(a,{maxSnack:4,preventDuplicate:!0,ref:r,action:e=>t.createElement(n,{onClick:l(e),style:{color:"#FFF"}},"关闭")},e)},Y="https://joli-vin-58133.herokuapp.com/";var Z=`${Y}api`;const ee=new class{constructor(){this.config={headers:{}},this.token="",this.socket=null}setToken(e){this.config={headers:{Authorization:`Bearer ${e}`}},this.token=e;const t=r(Y,{path:"/api/ws",auth:{token:`Bearer ${e}`},autoConnect:!1});t.connect(),this.socket=t}clearToken(){var e;this.config={headers:{}},this.token="",null==(e=this.socket)||e.off(),this.socket=null}async get(e){return(await l.get(`${Z}${e}`,this.config)).data}async post(e,t){return(await l.post(`${Z}${e}`,t,this.config)).data}async put(e,t){return(await l.put(`${Z}${e}`,t,this.config)).data}async del(e){return(await l.delete(`${Z}${e}`,this.config)).data}};var te=async e=>await ee.get(`/bili/getUperInfo/${e}`);var ae=async e=>await ee.get(`/sub/getUpdate/${e}`),ne=async()=>await ee.get("/sub/getAllUpdate"),re=async()=>await ee.get("/sub/getAllStatus"),le=async e=>await ee.get(`/sub/addSubscribe/${e}`),ce=async e=>{await ee.del(`/sub/delSubscribe/${e}`)},oe=async e=>await ee.put(`/sub/markSubscribeRead/${e}`),se=async e=>await ee.get(`/sub/updateVideos/${e}`),ie=async e=>new Promise((t=>{const a=ee.socket;a.emit("updateAllSubscribe"),a.on("updateAllSubscribe",(e=>{t(e)})),e&&a.on("updateASubscribe",e)}));const me=e=>{const[a,n]=t.useState(!1);return t.createElement(c,{style:e.style,onMouseOver:()=>{n(!0)},onMouseOut:()=>{n(!1)},raised:a},e.children)};var ue=async(e,t)=>{const a=await ee.post("/login",{username:e,password:t});return ee.setToken(a.token),localStorage.setItem("userToken",a.token),a},de=async()=>{await ee.get("/login/revokeToken"),localStorage.removeItem("userToken")};const pe=()=>{const{enqueueSnackbar:e}=o();return{inherit:t=>{e(t,{variant:"default"})},success:t=>{e(t,{variant:"success"})},err:t=>{e(t,{variant:"error"})},warn:t=>{e(t,{variant:"warning"})},info:t=>{e(t,{variant:"info"})}}},Ee=()=>{const e=pe(),t=s();return a=>{var n;switch(console.error(a),null==(n=a.response)?void 0:n.status){case 409:e.err("[409] 与已存在资源冲突");break;case 401:e.err("[401] 认证失败"),localStorage.removeItem("userToken"),t.push("/login");break;case 400:e.err("[400] 请求不合法");break;default:e.err(a.message)}switch(a.message){case"Request failed with status code 401":e.err("[401] 认证失败"),localStorage.removeItem("userToken"),t.push("/login")}}},he=()=>i(),ge=m,we=u("newVideo/initNewVideos",(async()=>await ne())),ye=u("newVideo/addNewVideos",(async e=>await ae(e)));var ve=d({name:"newVideo",initialState:[],reducers:{addVideo:(e,t)=>{e.push(t.payload)}},extraReducers:e=>{e.addCase(we.pending,(()=>[])),e.addCase(we.fulfilled,((e,t)=>{e.push(...t.payload)})),e.addCase(ye.fulfilled,((e,t)=>{e.push(...t.payload)}))}}).reducer;const ke=()=>{const e=pe(),a=he(),n=Ee(),[r,l]=t.useState(!1),[c,o]=t.useState(0);return t.createElement("div",{style:{position:"relative"}},t.createElement(p,{onClick:async t=>{t.preventDefault();try{l(!0),o(0);const{totalUpdates:t}=await ie((t=>{e.success(`${t.name} 新增 ${t.updates} 条视频`),o(100*t.progress)}));e.success(`共更新 ${t} 条视频`),l(!1),a(we()).unwrap().catch((e=>{n(e)}))}catch(r){n(r)}},color:"inherit",disabled:r},t.createElement(E,null)),r&&t.createElement(h,{variant:"determinate",value:c,color:"inherit",size:24,style:{position:"absolute",top:12,left:12}}))},fe=g((e=>y({grow:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{display:"block",[e.breakpoints.up("sm")]:{display:"block"}},section:{display:"flex"}}))),be=()=>{const e=m((e=>e.newVideo));return t.createElement(p,{"aria-label":`${e.length} 个新视频`,color:"inherit"},t.createElement($,{badgeContent:e.length,color:"secondary"},t.createElement(T,null)))},Ce=t.forwardRef(((e,a)=>{const n=s(),r=Ee();if(t.useEffect((()=>{e.setToken(localStorage.getItem("userToken"))}),[e]),null===e.token)return t.createElement(w,{onClick:()=>{n.push("/login")}},"登录/注册");ee.setToken(e.token);return t.createElement(w,{onClick:t=>{t.preventDefault(),localStorage.removeItem("userToken"),e.setToken(null);try{de()}catch(a){r(a)}ee.clearToken(),n.push("/login"),e.handleMenuClose()}},"退 出")})),Se=({title:e})=>{const a=fe(),[n,r]=t.useState(null),[l,c]=t.useState(null),o=Boolean(n),s=()=>{r(null)},i="primary-search-account-menu",m=t.createElement(I,{anchorEl:n,anchorOrigin:{vertical:"top",horizontal:"right"},id:i,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:o,onClose:s},t.createElement(Ce,{handleMenuClose:s,token:l,setToken:c}));return t.createElement("div",{className:a.grow,style:{marginBottom:72}},t.createElement(v,{position:"fixed"},t.createElement(k,null,t.createElement(p,{edge:"start",className:a.menuButton,color:"inherit","aria-label":"open drawer"},t.createElement(f,null)),t.createElement(b,{className:a.title,variant:"h6",noWrap:!0},e),t.createElement("div",{className:a.grow}),t.createElement("div",{className:a.section},ee.token&&t.createElement(t.Fragment,null,t.createElement(ke,null),t.createElement(be,null)),t.createElement(p,{edge:"end","aria-label":"account of current user","aria-controls":i,"aria-haspopup":"true",onClick:e=>{r(e.currentTarget)},color:"inherit"},null===l?t.createElement(C,null):t.createElement(S,null))))),m)},$e=()=>{const[e,a]=t.useState(""),[r,l]=t.useState(),c=Ee(),o=s(),i=pe();return t.createElement(t.Fragment,null,t.createElement(Se,{title:"新增订阅"}),t.createElement(R,{maxWidth:"xs"},t.createElement(me,null,t.createElement(x,null,t.createElement(p,{style:{position:"absolute"},onClick:e=>{e.preventDefault(),o.push("/")}},t.createElement(B,null)),t.createElement(D,{container:!0,justify:"center"},t.createElement(D,{item:!0},t.createElement(b,{variant:"h4",align:"center",gutterBottom:!0},"新增订阅")),t.createElement(D,{item:!0,style:{width:"100%"}},t.createElement(U,{fullWidth:!0,variant:"outlined",label:"up 主 UID",value:e,onChange:e=>{l(void 0),a(e.target.value)},InputProps:{endAdornment:t.createElement(O,{position:"end"},t.createElement(p,{size:"small",onClick:async t=>{t.preventDefault();try{const{data:t}=await te(e),a={mid:t.card.mid,name:t.card.name,follower:t.follower,sign:t.card.sign,archiveCount:t.archive_count};l(a)}catch(a){c(a)}}},t.createElement(j,null)))}})),r&&t.createElement(t.Fragment,null,t.createElement(D,{item:!0,style:{width:"100%"}},t.createElement(b,{gutterBottom:!0},"请确认以下信息："),t.createElement(z,null,t.createElement(b,{component:"div"},t.createElement("table",{style:{width:"100%"}},t.createElement("tbody",null,t.createElement("tr",null,t.createElement("td",null,"UID："),t.createElement("td",null,r.mid)),t.createElement("tr",null,t.createElement("td",null,"昵称："),t.createElement("td",null,r.name)),t.createElement("tr",null,t.createElement("td",null,"关注："),t.createElement("td",null,r.follower)),t.createElement("tr",null,t.createElement("td",null,"签名："),t.createElement("td",null,r.sign)),t.createElement("tr",null,t.createElement("td",null,"视频数："),t.createElement("td",null,r.archiveCount))))))),t.createElement(D,{item:!0},t.createElement(n,{variant:"outlined",color:"primary",onClick:async t=>{t.preventDefault();try{await le(e),i.success("关注成功！")}catch(a){c(a)}}},"提交"))))))))},Te=({icon:e,content:a})=>t.createElement(D,{item:!0},t.createElement(b,{gutterBottom:!0,variant:"body2",color:"textSecondary",component:"p",style:{display:"flex",alignItems:"center"}},e,a)),Ie=({video:e})=>t.createElement(t.Fragment,null,t.createElement(c,null,t.createElement(z,{onClick:()=>{setTimeout((()=>{window.open(`http://www.bilibili.com/video/${e.bvid}`)}),200)},style:{height:"100%"}},t.createElement(x,null,t.createElement(b,{variant:"body2",gutterBottom:!0},e.title),t.createElement(D,{container:!0,spacing:1,direction:"row",justify:"center"},t.createElement(Te,{content:e.play,icon:t.createElement(F,{fontSize:"small"})}),t.createElement(Te,{content:e.comment,icon:t.createElement(M,{fontSize:"small"})}),t.createElement(Te,{content:e.review,icon:t.createElement(V,{fontSize:"small"})}),t.createElement(Te,{content:e.bvid,icon:t.createElement(A,{fontSize:"small"})})))))),Re=()=>{const e=m((e=>e.newVideo));return t.createElement(D,{container:!0,spacing:1},e.map((e=>t.createElement(D,{item:!0,key:e.id},t.createElement(Ie,{video:e})))))},xe=u("uper/initUpers",(async()=>await re()));var Be=d({name:"uper",initialState:[],reducers:{addUper:(e,t)=>{e.push(t.payload)}},extraReducers:e=>{e.addCase(xe.pending,(()=>[])),e.addCase(xe.fulfilled,((e,t)=>{t.payload.forEach((t=>{e.push(t)}))}))}}).reducer;const De=({children:e,onClick:a})=>t.createElement(D,{item:!0},t.createElement(n,{variant:"outlined",onClick:a,style:{height:32}},e)),Ue=({uper:e,setOver:a})=>t.createElement(c,{style:{minHeight:100}},t.createElement(z,{onClick:()=>{a(!0)},style:{minHeight:100}},t.createElement(x,null,t.createElement(D,{container:!0,justify:"center"},t.createElement(b,{variant:"h5",align:"center"},e.card.name))))),Oe=({uper:e,setOver:a})=>{const n=he(),r=Ee(),l=pe();return t.createElement(W,{onClickAway:()=>{a(!1)}},t.createElement(c,{raised:!0,style:{minHeight:100}},t.createElement(x,{style:{padding:4}},t.createElement(D,{container:!0,justify:"center",alignItems:"center",spacing:1,style:{minHeight:100}},t.createElement(De,{onClick:async t=>{t.preventDefault(),await oe(e.id),n(we()).unwrap().catch((e=>{r(e)}))}},"已读"),t.createElement(De,{onClick:async t=>{t.preventDefault();const{updates:a}=await se(e.id);l.success(`${e.card.name} 新增 ${a} 条视频`),n(ye(e.id)).unwrap().catch((e=>{r(e)}))}},"更新"),t.createElement(De,{onClick:async t=>{t.preventDefault(),window.open(`https://space.bilibili.com/${e.mid}`)}},"空间"),t.createElement(De,{onClick:async t=>{t.preventDefault(),await ce(e.id),l.info("删除成功"),n(we()).unwrap().catch((e=>{r(e)})),n(xe()).unwrap().catch((e=>{r(e)}))}},"取关")))))},je=({uper:e})=>{const[a,n]=t.useState(!1);return t.createElement(D,{item:!0,xs:12,md:4,lg:2},a?t.createElement(Oe,{uper:e,setOver:n}):t.createElement(Ue,{uper:e,setOver:n}))},ze=()=>{const e=s(),a=ge((e=>e.uper));return t.createElement(D,{container:!0,spacing:1},a.map((e=>t.createElement(je,{uper:e,key:e.id}))),t.createElement(D,{item:!0},t.createElement(me,{style:{width:"100%",height:"100%"}},t.createElement(z,{onClick:t=>{t.preventDefault(),e.push("/addSubscribe")}},t.createElement(x,null,t.createElement(N,{style:{height:64,width:64,color:"rgba(0, 0, 0, 0.54)"}}))))))},Fe=()=>{const e=s(),a=he(),n=Ee();return t.useEffect((()=>{const t=localStorage.getItem("userToken");null===t?e.push("/login"):(ee.setToken(t),a(we()).unwrap().catch((e=>{n(e)})),a(xe()).unwrap().catch((e=>{n(e)})))}),[]),t.createElement(t.Fragment,null,t.createElement(Se,{title:"瓦尔基里"}),t.createElement(b,{gutterBottom:!0},"页面右上角刷新键可获取全部更新",t.createElement("br",null),"点击up主卡片进行单独操作"),t.createElement(D,{container:!0,spacing:1},t.createElement(ze,null),t.createElement(Re,null)))};var Me=async(e,t,a)=>await ee.post("/users",{username:e,name:t,password:a});const Ve=H({switchBase:{color:"#f50057","&$checked":{color:"#3f51b5"},"&$checked + $track":{backgroundColor:"#7986cb"}},checked:{},track:{}})(_),Ae=()=>{const[e,a]=t.useState(""),[r,l]=t.useState(""),[c,o]=t.useState(""),[i,m]=t.useState(!0),u=s(),d=Ee();return t.createElement("div",{style:{background:"url(/assets/background.a47ead67.png) center center no-repeat fixed",backgroundSize:"cover",height:"100vh",width:"100%",position:"absolute",left:0,top:0,right:0,bottom:0}},t.createElement(Se,{title:i?"瓦尔基里-登录":"瓦尔基里-注册"}),t.createElement(R,{maxWidth:"xs"},t.createElement(me,{style:{marginTop:128}},t.createElement(x,null,t.createElement(b,{variant:"h4",align:"center",gutterBottom:!0},i?"登录":"注册"),t.createElement(D,{container:!0,alignContent:"center",spacing:1,justify:"center"},t.createElement(b,{component:"div"},t.createElement(D,{component:"label",container:!0,alignItems:"center",spacing:1},t.createElement(D,{item:!0},"注册"),t.createElement(D,{item:!0},t.createElement(Ve,{checked:i,color:"primary",onChange:e=>{m(e.target.checked)}})),t.createElement(D,{item:!0},"登录"))),t.createElement(D,{item:!0,style:{width:"100%"}},t.createElement(U,{fullWidth:!0,variant:"outlined",type:"username",label:"用户名",autoComplete:"username",value:e,onChange:e=>a(e.target.value)})),!i&&t.createElement(D,{item:!0,style:{width:"100%"}},t.createElement(U,{fullWidth:!0,variant:"outlined",label:"昵称",autoComplete:"nickname",value:r,onChange:e=>l(e.target.value)})),t.createElement(D,{item:!0,style:{width:"100%"}},t.createElement(U,{fullWidth:!0,variant:"outlined",type:"password",label:"密码",autoComplete:i?"current-password":"new-password",value:c,onChange:e=>o(e.target.value)})),i?t.createElement(D,{item:!0},t.createElement(n,{color:"primary",variant:"contained",onClick:async t=>{t.preventDefault();try{const t=await ue(e,c);ee.setToken(t.token),localStorage.setItem("userToken",t.token),u.push("/")}catch(a){d(a)}}},"登录")):t.createElement(D,{item:!0},t.createElement(n,{color:"secondary",variant:"contained",onClick:async t=>{t.preventDefault();try{await Me(e,r,c);const t=await ue(e,c);ee.setToken(t.token),localStorage.setItem("userToken",t.token)}catch(a){d(a)}}},"注册")))))))},Ne=P({reducer:{newVideo:ve,uper:Be}}),We=()=>t.createElement(q,{store:Ne},t.createElement(X,null,t.createElement(G,null,t.createElement(J,null,t.createElement(K,{path:"/login"},t.createElement(Ae,null)),t.createElement(K,{path:"/addSubscribe"},t.createElement($e,null)),t.createElement(K,{path:"/"},t.createElement(Fe,null))))));!function(t={}){const{immediate:a=!1,onNeedRefresh:n,onOfflineReady:r}=t;let l;"serviceWorker"in navigator&&(l=new e("/sw.js",{scope:"/"}),l.addEventListener("activated",(e=>{e.isUpdate?window.location.reload():null==r||r()})),l.register({immediate:a}).then((e=>e)))}({onOfflineReady(){}}),Q.render(t.createElement(We,null),document.getElementById("root"));
